# Lefthook configuration - Optimized for Rust + TypeScript
# https://github.com/evilmartians/lefthook
#
# Strategy: Fast pre-commit, comprehensive pre-push, full CI validation

[whitespace]
enabled = true
ignored_extensions = ["svg", "patch"]

[ci]
skip = ["local"]

# ================================
# Pre-commit: Fast format checks only
# ================================

[hooks.pre-commit]
run = "parallel"

[actions]
# Format checks (instant)

[action.rust_format_check]
command = "cargo fmt --all -- --check"
run = "workspace"
stage = ["pre-commit"]
files = ["Cargo.toml", "crates/**/*.rs", "src-tauri/**/*.rs"]

[action.frontend_format_check]
skip = ["not exist - frontend/node_modules"]
command = "cd frontend && npm run format:check --silent || true"
run = "workspace"
stage = ["pre-commit"]
files = ["frontend/**/*.{ts,tsx,js,jsx,json,css,scss,md}"]

# ================================
# Pre-push: Full validation
# ================================

[hooks.pre-push]

# Rust validation

[action.rust_clippy]
command = "cargo clippy --workspace -- -D warnings"
run = "workspace"
stage = ["pre-push"]
files = ["Cargo.toml", "crates/**/*.rs", "src-tauri/**/*.rs"]

[action.rust_tests]
command = "cargo test --workspace --no-fail-fast"
run = "workspace"
stage = ["pre-push"]
files = ["Cargo.toml", "crates/**/*.rs", "src-tauri/**/*.rs"]

# Frontend validation

[action.frontend_lint]
skip = ["not exist - frontend/node_modules"]
command = "cd frontend && npm run lint --silent || true"
run = "workspace"
stage = ["pre-push"]
files = ["frontend/**/*.{ts,tsx,js,jsx}"]

[action.frontend_lint_css]
skip = ["not exist - frontend/node_modules"]
command = "cd frontend && npm run lint:css --silent || true"
run = "workspace"
stage = ["pre-push"]
files = ["frontend/**/*.{css,scss}"]

[action.frontend_tests]
skip = ["not exist - frontend/node_modules"]
command = "cd frontend && npm run test:run --silent || true"
run = "workspace"
stage = ["pre-push"]
files = ["frontend/**/*.{ts,tsx,js,jsx}"]

# ================================
# Commit-msg: Conventional commits
# ================================

[hooks.commit-msg]
pattern = "^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\\(.+\\))?: .{10,}"
