# Lefthook configuration - Optimized for Rust + TypeScript
# https://github.com/evilmartians/lefthook
#
# Strategy: Fast pre-commit (format only), comprehensive pre-push (smoke + lint + tests)

[whitespace]
enabled = true
ignored_extensions = ["svg", "patch"]

[ci]
skip = ["local"]

# ================================
# Pre-commit: Format checks only (fast)
# ================================

[pre-commit]
parallel = true

[pre-commit.commands.rust-fmt]
run = "cargo fmt --all -- --check"
glob = "*.rs"

[pre-commit.commands.frontend-fmt]
run = "cd frontend && npm run format:check --silent"
glob = "frontend/**/*.{ts,tsx,js,jsx,json,css,scss,md}"
skip = [{run = "test ! -d frontend/node_modules"}]

# ================================
# Pre-push: Smoke + lint + tests
# ================================

[pre-push]
parallel = true

[pre-push.commands.rust-check]
run = "cargo check --workspace"
glob = "*.rs"

[pre-push.commands.rust-clippy]
run = "cargo clippy --workspace --lib --exclude abseil -- -D warnings"
glob = "*.rs"

[pre-push.commands.rust-tests]
run = "cargo test --workspace --exclude abseil --no-fail-fast"
glob = "*.rs"

[pre-push.commands.frontend-lint]
run = "cd frontend && npm run lint --silent"
glob = "frontend/**/*.{ts,tsx,js,jsx}"
skip = [{run = "test ! -d frontend/node_modules"}]

[pre-push.commands.frontend-tests]
run = "cd frontend && npm run test:run --silent"
glob = "frontend/**/*.{ts,tsx,js,jsx}"
skip = [{run = "test ! -d frontend/node_modules"}]

# ================================
# Commit-msg: Conventional commits
# ================================

[commit-msg]
commands.validate.run = "grep -qE '^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\\(.+\\))?: .{10,}' {1}"
